version: '3.8'

services:
  oai-gnb:
    image: oaisoftwarealliance/oai-gnb:develop
    container_name: rfsim5g-oai-gnb
    privileged: true
    environment:
      USE_SA_TDD_MONO: 'yes'
      GNB_NAME: 'gNB-OAI'
      MCC: '208'
      MNC: '93'
      MNC_LENGTH: '2'
      TAC: '1'
      NSSAI_SST: '1'
      NSSAI_SD: '1'
      AMF_IP_ADDRESS: '192.168.70.132'
      GNB_NGA_IF_NAME: 'eth0'
      GNB_NGA_IP_ADDRESS: '192.168.70.129'
      GNB_NGU_IF_NAME: 'eth0'
      GNB_NGU_IP_ADDRESS: '192.168.70.129'
      USE_ADDITIONAL_OPTIONS: '--rfsim --log_config.global_log_level info'
    volumes:
      - ./configs/gnb-rfsim-sa.conf:/opt/oai-gnb/etc/gnb.conf:ro
    healthcheck:
      test: /bin/bash -c "pgrep nr-softmodem"
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      public_net:
        ipv4_address: 192.168.70.129

networks:
  public_net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.70.0/24
          gateway: 192.168.70.1
