Active_gNBs = ( "gNB-OAI" );

gNBs =
(
 {
    gNB_ID = 0xe00;
    gNB_name  = "gNB-OAI";
    tracking_area_code  =  1;
    plmn_list = ({
                  mcc = 208;
                  mnc = 95;
                  mnc_length = 2;
                  snssaiList = ({
                                  sst = 1;
                                  sd  = 0xffffff;
                                });
                 });

    nr_cellid = 12345678L;

    amf_ip_address = ( 
      { 
        ipv4       = "172.30.0.100";
        ipv6       = "::";
        active     = "yes";
        preference = "ipv4";
      }
    );

    NETWORK_INTERFACES = {
        GNB_INTERFACE_NAME_FOR_NG_AMF = "eth0";
        GNB_IPV4_ADDRESS_FOR_NG_AMF   = "172.30.0.131/24";
        GNB_INTERFACE_NAME_FOR_NGU    = "eth0";
        GNB_IPV4_ADDRESS_FOR_NGU      = "172.30.0.131/24";
        GNB_PORT_FOR_NGU              = 2152;
    };

    nr_operating_mode = "sa";
    nr_band = 78;
    cell_type = "CELL_MACRO_GNB";
    nr_scs = 30;

    servingCellConfigCommon = (
      {
        physCellId = 0;

        # Frequency configuration for Band 78
        dl_frequencyBand = 78;
        absoluteFrequencySSB = 621312;
        dl_absoluteFrequencyPointA = 620040;
        dl_offstToCarrier = 0;
        dl_carrierBandwidth = 106;
        dl_subcarrierSpacing = 1;
        initialDLBWPlocationAndBandwidth = 28875;
        initialDLBWPsubcarrierSpacing = 1;
        initialDLBWPcontrolResourceSetZero = 11;
        initialDLBWPsearchSpaceZero = 0;

        ul_frequencyBand = 78;
        ul_offstToCarrier = 0;
        ul_carrierBandwidth = 106;
        ul_subcarrierSpacing = 1;
        pMax = 20;
        initialULBWPlocationAndBandwidth = 28875;
        initialULBWPsubcarrierSpacing = 1;

        # RACH Configuration
        prach_ConfigurationIndex = 98;
        prach_msg1_FDM = 0;
        prach_msg1_FrequencyStart = 0;
        zeroCorrelationZoneConfig = 12;
        preambleReceivedTargetPower = -104;
        preambleTransMax = 6;
        powerRampingStep = 1;
        ra_ResponseWindow = 4;
        ssb_perRACH_OccasionAndCB_PreamblesPerSSB_PR = 3;
        ssb_perRACH_OccasionAndCB_PreamblesPerSSB = 15;
        ra_ContentionResolutionTimer = 7;
        rsrp_ThresholdSSB = 19;
        prach_RootSequenceIndex_PR = 2;
        prach_RootSequenceIndex = 1;
        msg1_SubcarrierSpacing = 1;
        restrictedSetConfig = 0;
        msg3_DeltaPreamble = 1;
        p0_NominalWithGrant = -90;

        # PUCCH Configuration
        pucchGroupHopping = 0;
        hoppingId = 40;
        p0_nominal = -90;
        ssb_PositionsInBurst_PR = 2;
        ssb_PositionsInBurst_Bitmap = 1;
        ssb_periodicityServingCell = 2;
        dmrs_TypeA_Position = 0;
        subcarrierSpacing = 1;

        # TDD Configuration
        referenceSubcarrierSpacing = 1;
        dl_UL_TransmissionPeriodicity = 6;
        nrofDownlinkSlots = 7;
        nrofDownlinkSymbols = 6;
        nrofUplinkSlots = 2;
        nrofUplinkSymbols = 4;

        ssPBCH_BlockPower = -25;
      }
    );

    nr_cell_list = (
      {
        physical_cell_id = 0;
        cell_type = "CELL_MACRO_GNB";
        band = 78;
        dl_absoluteFrequencyPointA = 620040;
        ul_absoluteFrequencyPointA = 620040;
        nrofResourceBlocks_DLUL = 106;
        initialDownlinkBWPCommon_resourceAllocationType = 1;
        initialDownlinkBWPCommon_k0 = 1;
        initialUplinkBWPCommon_resourceAllocationType = 1;
        initialUplinkBWPCommon_k0 = 1;
        SubcarrierSpacingCommon = 30;
        
        # CRITICAL: K2 timing parameters
        # For TDD with 30kHz SCS, k2 must be >= 3 for PUSCH scheduling
        k2 = 3;
        
        Nid_cell = 0;
        ssb_SubcarrierOffset = 0;
        n_TimingAdvance_Offset = 0;
        dmrs_TypeA_Position = "pos2";
        pucch_ResourceCommon = 0;
        pucch_GroupHopping = "NEITHER";
        L_max = 4;
        P_max = 20;
        amf_mode = 1;
      }
    );

    pdsch_AntennaPorts = 1;
    pusch_AntennaPorts = 1;
  }
);

MACRLCs = (
  {
    num_cc = 1;
    tr_s_preference = "local_L1";
    tr_n_preference = "local_RRC";
    ulsch_max_frame_inactivity = 0;
    min_grant_prb = 5;
    min_grant_mcs = 9;
  }
);

L1s = (
  {
    num_cc = 1;
    tr_n_preference = "local_mac";
    max_ldpc_iterations = 6;
  }
);

RUs = (
  {
    local_rf = "yes"
    nb_tx = 1
    nb_rx = 1
    att_tx = 0
    att_rx = 0;
    bands = [78];
    max_pdschReferenceSignalPower = -27;
    max_rxgain = 114;
    eNB_instances = [0];
    sdr_addrs = "type=b200";
  }
);  

THREAD_STRUCT = (
  {
    parallel_config = "PARALLEL_SINGLE_THREAD";
    worker_config = "WORKER_ENABLE";
  }
);

rfsimulator = {
  serveraddr = "server";
  serverport = "4043";
  modelname = "AWGN";
};

log_config = {
  global_log_level = "info";
};

security = {
  ciphering_algorithms = ( "nea0" );
  integrity_algorithms = ( "nia2", "nia0" );
};
